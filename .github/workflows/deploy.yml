name: Deploy Laravel (Modo Diagn√≥stico + Fix)

on:
  push:
    branches:
      - main

jobs:
  web-deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
      - name: Get latest code
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: composer install --no-ansi --no-interaction --no-scripts --no-progress --prefer-dist

      - name: Upload via LFTP (Paso a Paso)
        run: |
          sudo apt-get update
          sudo apt-get install -y lftp
          
          lftp -c "set ftp:ssl-allow no; set ssl:verify-certificate no; open -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_SERVER }}; echo '--- LISTADO RAIZ ---'; ls -la; echo '--- ENTRANDO A PUBLIC_HTML ---'; cd public_html; mirror -R -v --parallel=2 --exclude .git/ --exclude .github/ --exclude node_modules/ --exclude .env ./ ."